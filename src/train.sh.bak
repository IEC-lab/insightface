#!/usr/bin/env bash
# export MXNET_CPU_WORKER_NTHREADS=2
export MXNET_CUDNN_AUTOTUNE_DEFAULT=0
export MXNET_ENGINE_TYPE=ThreadedEnginePerDevice
export MXNET_ENABLE_GPU_P2P=0

DATA_DIR=/home/data/insight/insight/faces_ms1m_112x112

NETWORK=r34
PREFIX_DIR=../models/am_r34
if [ ! -d $PREFIX_DIR ]; then
    mkdir -p $PREFIX_DIR
fi

# CUDA_VISIBLE_DEVICES='0,1,2,3,4,5,6,7' \
CUDA_VISIBLE_DEVICES='0,1,2,3,4,5,6,7' \
    python -u train_softmax.py \
	--network "$NETWORK" \
	--loss-type 4 \
	--margin-m 0.5 \
    --data-dir $DATA_DIR \
	--prefix $PREFIX_DIR/model \
	--per-batch-size 128 \
	--lr 0.1 \
	--emb-size 256 \
	2>&1 | tee $PREFIX_DIR/train.log

